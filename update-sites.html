<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Atlas Frontend</title>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <script src="https://unpkg.com/vue"></script>
  <script src="https://unpkg.com/vuex"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"
          integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
          crossorigin="anonymous"></script>
  <script
     src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <link
     href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
     media="all" rel="stylesheet"/>
  <link href="src/css/env-dropdown.css" media="all" rel="stylesheet"/>
  <link href="src/css/autocomplete.css" media="all" rel="stylesheet"/>
  <link href="src/css/style.css" media="all" rel="stylesheet"/>

  <link rel="import" href="src/partials/navbar.html">
  <link rel="import" href="src/partials/listing.html">
  <link rel="import" href="src/partials/row.html">
  <link rel="import" href="src/partials/confirm-button.html">
  <link rel="import" href="src/partials/autocomplete-input.html">
</head>
<body>
<div id="atlas-navbar">
  <atlas-navbar
     :routes="routes"
     :environments="environments">
  </atlas-navbar>
</div>
<div id="list-full-sites" class="container">
  <message-area id="alert" :messages="messages" v-if="messages.length > 0"></message-area>
  <div class="form-group">
    <form id="search" class="row">
      <legend>Search</legend>
      <input type="text" placeholder="?where={&#34;code.package&#34;:&#34;5939629989b0dc0e497e35ad&#34;}" id="querySites" class="form-control" name="querySites" v-model="siteQuery">
      <button class="btn btn-primary pull-right" @click.prevent="getSites(siteQuery)">Query sites</button>
    </form>
  </div>

  <div class="form-group col-md-6">
    <legend id="remove-packages">Remove Packages</legend>
    <select multiple class="form-control" id="packages-to-add" v-model="removePackages" style="height:300px;">
      <option disabled selected value> -- select an option -- </option>
      <template v-for="site in sites[0]">
        <option :value="index" v-if="site.code.package != null" v-for="index in site.code.package">
          {{codeName(index)}}: {{index}}
        </option>
      </template>
    </select>
    <!--<p v-for="site in sites[0]">{{site.code.package}}</p>-->
  </div>
  <div class="form-group col-md-6">
    <legend id="add-packages">Add Packages</legend>
    <select multiple class="form-control" id="packages-to-remove" v-model="updatePackages" style="height:300px;">
      <option disabled selected value> -- select an option -- </option>
      <template v-for="code in codes[0]" v-if="code.meta.code_type !== 'core'">
        <option :value="code._id" v-if="code.meta.code_type !== 'profile'">
          {{code.meta.label}} {{code.meta.name}}: {{code._id}}
        </option>
      </template>
    </select>
  </div>

  <div class="container-fluid">
    <legend>Send update to Atlas:</legend>
    <div class="form-group col-md-10">
      <div class="col-md-5">
        <h3>Add:</h3>
          <ul v-for="package in updatePackages"><li>- {{codeName(package)}}</li></ul>
        <h3>Remove:</h3>
          <ul v-for="package in removePackages"><li>- {{codeName(package)}}</li></ul>
      </div>
      <div class="col-md-5">
        <h3>Sites to update:</h3>
          <ul v-for="site in sites[0]"><li>- {{site.path}}</li></ul>
      </div>
    </div>
    <div class="form-group col-md-2">
      <button class="btn btn-primary pull-right" id="update-packages" @click="sendToAtlas">Update Packages</button>
    </div>
  </div>
</div>

<script src="src/config/config.js"></script>
<script src="src/config/routes.js"></script>
<script src="src/js/utilities.js"></script>
<script src="src/js/components.js"></script>
<script src="src/js/navbar.js"></script>
<script src="src/js/update-sites.js"></script>
</body>
</html>
